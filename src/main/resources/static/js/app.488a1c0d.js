(function(){"use strict";var t={1337:function(t,e,a){var n=a(9242),o=a(3396);const r={key:0};function s(t,e,a,n,s,i){const l=(0,o.up)("router-link"),c=(0,o.up)("router-view");return(0,o.wg)(),(0,o.iD)("div",null,[t.isLoggedIn?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("nav",r,[(0,o.Wm)(l,{to:"/"},{default:(0,o.w5)((()=>[(0,o.Uk)("Login")])),_:1}),(0,o.Uk)(" | "),(0,o.Wm)(l,{to:"/register"},{default:(0,o.w5)((()=>[(0,o.Uk)("Register")])),_:1})])),(0,o._)("main",null,[(0,o.Wm)(c)])])}var i=a(7327),l=a(6520),c=a(65),d=(0,c.MT)({state:{sync:[],dashboardData:[],clientData:null},mutations:{setDashboardData(t,e){t.dashboardData=e},setClientData(t,e){t.clientData=e},setSync(t,e){t.sync=e}},actions:{fireSync({commit:t},e){t("setSync",e)},setDashboardDataSyncCount({commit:t},e){const a=this.state.dashboardData.map((t=>t.metadataId!=e.metadataId?t:e));console.log("for setDashboardData",e),t("setDashboardData",a)},updateDashboardData({commit:t},e){t("setDashboardData",e)},addDashboardData({commit:t},e){const a=[...this.state.dashboardData,...e].sort(((t,e)=>t.metadataId>e.metadataId?-1:1));t("setDashboardData",a)},updateClientData({commit:t},e){t("setClientData",e)},updateClientIDandSecrect({commit:t},e){const a={clientId:e.clientID,clientSecret:e.clientSecret,myLoginToken:this.state.clientData?.myLoginToken??"",stravaToken:this.state.clientData?.stravaToken??null,username:this.state.clientData?.username??""};t("setClientData",a)},setClientStravaData({commit:t},e){const a=this.state.clientData,n={clientId:a?.clientId??"",clientSecret:a?.clientSecret??"",myLoginToken:a?.myLoginToken??"",username:a?.username??"",stravaToken:{accessToken:e.accessToken,refreshToken:e.refreshToken}};t("setClientData",n)}},getters:{getDashboardData(t){return t.dashboardData},getClientData(t){return t.clientData},getSync(t){return t.sync}}});class u extends l.w3{constructor(...t){super(...t),(0,i.Z)(this,"isLoggedIn",!1)}mounted(){const t=d.getters.getClientData;d.watch((()=>d.getters.getClientData),(t=>{this.isLoggedIn=null!=t?.myLoginToken})),this.isLoggedIn=null!=t?.myLoginToken}}var h=a(89);const g=(0,h.Z)(u,[["render",s]]);var p=g,m=a(2483);const y={class:"login"},w=(0,o._)("h1",null,"Welcome to login",-1),f=(0,o._)("label",{for:"username"},"Username:",-1),D=(0,o._)("br",null,null,-1),v=(0,o._)("br",null,null,-1),b=(0,o._)("label",{for:"password"},"Password:",-1),k=(0,o._)("br",null,null,-1),S=(0,o._)("br",null,null,-1),T=(0,o._)("input",{type:"submit",value:"Login"},null,-1);function _(t,e,a,r,s,i){const l=(0,o.up)("Dashboard");return(0,o.wg)(),(0,o.iD)("div",y,[w,(0,o._)("form",{onSubmit:e[2]||(e[2]=(0,n.iM)(((...e)=>t.onLoginSubmit&&t.onLoginSubmit(...e)),["prevent"]))},[f,(0,o.wy)((0,o._)("input",{type:"text",id:"username","onUpdate:modelValue":e[0]||(e[0]=e=>t.username=e),name:"username"},null,512),[[n.nr,t.username]]),D,v,b,(0,o.wy)((0,o._)("input",{type:"password",id:"password","onUpdate:modelValue":e[1]||(e[1]=e=>t.password=e),name:"password"},null,512),[[n.nr,t.password]]),k,S,T],32),(0,o.Wm)(l,{msg:"dere"})])}a(7658);class R{constructor(){(0,i.Z)(this,"ip",""),(0,i.Z)(this,"port","")}getUrl(){return`${this.ip}${this.port}`}getApp(){return`${this.getUrl()}/app`}getRunUrl(){return`${this.getUrl()}/api/runningApp`}getRideUrl(){return`${this.getUrl()}/api/RideApp`}}const C=(new R).getUrl(),I={login:t=>({url:C+"/api/login/",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})},L={login:t=>({url:C+"/api/login/",method:"POST",body:JSON.stringify(t),header:{"Content-Type":"application/json"}}),refresh:t=>({url:C+"/api/userReload",method:"GET",header:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),workoutDataInsert:(t,e,a,n)=>({url:C+"/api/workoutDataInsert",method:"POST",header:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({id:e,header:a,csv:n})}),metaDataInsert:(t,e,a)=>({url:C+"/api/metadataInsert",method:"POST",header:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({header:e,csv:a})}),setStravaData(t,e,a){return{url:C+"/api/userSetStravaData",method:"POST",header:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify({clientID:e,clientSecret:a})}}};class O{constructor(t,e,a,n,o){(0,i.Z)(this,"clientId",void 0),(0,i.Z)(this,"clientSecret",void 0),(0,i.Z)(this,"username",void 0),(0,i.Z)(this,"myLoginToken",void 0),(0,i.Z)(this,"metadatas",[]),this.username=t,this.myLoginToken=e,this.clientId=a,this.clientSecret=n,this.metadatas=o}toDashboardStruct(){return this.metadatas.map((t=>({averageHeartRate:t.averageHeartRate,averagePower:t.averagePower,averageSpeed:t.averageSpeed,metadataId:t.metadataId,sport:t.sport,startTime:t.startTime,totalDistance:t.totalDistance,totalTime:t.totalTime,workoutDataCount:t.workoutDataCount})))}toStore(){const t={clientId:this.clientId,clientSecret:this.clientSecret,myLoginToken:this.myLoginToken,username:this.username,stravaToken:null};d.dispatch("updateDashboardData",this.toDashboardStruct()),d.dispatch("updateClientData",t)}static fromJson(t){console.log(t);const e=t.metadatas.map((t=>({metadataId:t.id,sport:t.sport,startTime:t.startTime,totalDistance:t.totalDistance,totalTime:t.totalTime,workoutDataCount:t.count,averageHeartRate:t.averageHearRate,averagePower:t.averagePower,averageSpeed:t.averageSpeed})));return new O(t.username,t.myLoginToken,t.clientId,t.clientSecret,e)}}var A=function(t,e,a,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(s=(r<3?o(s):r>3?o(e,a,s):o(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s};let j=class extends l.w3{constructor(...t){super(...t),(0,i.Z)(this,"username",""),(0,i.Z)(this,"password","")}onLoginSubmit(){const t={username:this.username,password:this.password},e=I.login(t),a=(new R).getUrl();fetch(a+"/api/login",{method:e.method,body:e.body,headers:e.headers}).then((async t=>(console.log(t),t.json()))).then((t=>{console.log(t);let e=O.fromJson(t);e.toStore(),sessionStorage.setItem("accessToken",e.myLoginToken),document.cookie=`accessToken=${e.myLoginToken}`,this.$router.push({name:"Dashboard"})}))}};j=A([(0,l.Ei)({})],j);var Z=j;const P=(0,h.Z)(Z,[["render",_]]);var U=P;const z={class:"login"},M=(0,o._)("h1",null,"Register",-1),x=(0,o._)("label",{for:"username"},"Username:",-1),W=(0,o._)("br",null,null,-1),$=(0,o._)("br",null,null,-1),J=(0,o._)("label",{for:"password"},"Password:",-1),V=(0,o._)("br",null,null,-1),q=(0,o._)("br",null,null,-1),E=(0,o._)("label",{for:"password"},"Repeat Password:",-1),H=(0,o._)("br",null,null,-1),B=(0,o._)("br",null,null,-1),N=(0,o._)("input",{type:"submit",value:"Register"},null,-1);function F(t,e,a,r,s,i){return(0,o.wg)(),(0,o.iD)("div",z,[M,(0,o._)("form",{onSubmit:e[3]||(e[3]=(0,n.iM)(((...e)=>t.registerUser&&t.registerUser(...e)),["prevent"]))},[x,(0,o.wy)((0,o._)("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=e=>t.username=e),id:"username",name:"username"},null,512),[[n.nr,t.username]]),W,$,J,(0,o.wy)((0,o._)("input",{type:"password","onUpdate:modelValue":e[1]||(e[1]=e=>t.password=e),id:"password",name:"password"},null,512),[[n.nr,t.password]]),V,q,E,(0,o.wy)((0,o._)("input",{type:"password","onUpdate:modelValue":e[2]||(e[2]=e=>t.repeatPassword=e),id:"repeatPassword",name:"repeatPassword"},null,512),[[n.nr,t.repeatPassword]]),H,B,N],32)])}class G extends l.w3{constructor(...t){super(...t),(0,i.Z)(this,"username",""),(0,i.Z)(this,"password",""),(0,i.Z)(this,"repeatPassword","")}registerUser(){if(this.password!==this.repeatPassword)return void alert("Passwords do not match.");const t={username:this.username,password:this.password};fetch("/api/userCreate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((t=>{if(t.ok){const t={username:this.username,password:this.password},e=I.login(t),a=(new R).getUrl();fetch(a+"/api/login",{method:e.method,body:e.body,headers:e.headers}).then((async t=>(console.log(t),t.json()))).then((t=>{console.log(t);let e=O.fromJson(t);e.toStore(),this.$router.push({name:"Dashboard"})})),alert("Registration successful.")}else alert("Registration failed.")})).catch((t=>{console.error("Error:",t),alert("An error occurred during registration.")}))}}const K=(0,h.Z)(G,[["render",F]]);var Y=K,Q=a(7139);const X={key:0},tt=(0,o._)("div",null,[(0,o._)("h2",null," Authentication in Strava Success ")],-1),et=(0,o._)("label",{for:"loadLatestMetadata"},null,-1),at=(0,o._)("label",{for:"loadAllMetadata"},null,-1),nt=(0,o._)("br",null,null,-1),ot=(0,o._)("br",null,null,-1),rt={key:1},st=(0,o._)("label",{for:"clientID"},"clientID:",-1),it=(0,o._)("br",null,null,-1),lt=(0,o._)("br",null,null,-1),ct=(0,o._)("label",{for:"clientSecret"},"clientSecret:",-1),dt=(0,o._)("br",null,null,-1),ut=(0,o._)("br",null,null,-1),ht=(0,o._)("br",null,null,-1),gt=(0,o._)("br",null,null,-1),pt={key:4};function mt(t,e,a,r,s,i){const l=(0,o.up)("DashboardTable");return(0,o.wg)(),(0,o.iD)("div",null,[(0,o._)("h1",null," Welcome "+(0,Q.zw)(t.client?.username),1),t.isStravaLoggin?((0,o.wg)(),(0,o.iD)("div",X,[tt,(0,o._)("div",null,[et,(0,o._)("input",{type:"submit",value:"loadLatestMetadata",onClick:e[0]||(e[0]=(...e)=>t.onLoadLatestMetadata&&t.onLoadLatestMetadata(...e))}),at,(0,o._)("input",{type:"submit",value:"loadAllMetadata",onClick:e[1]||(e[1]=(...e)=>t.onLoadAllMetadata&&t.onLoadAllMetadata(...e))}),nt,ot,(0,o._)("button",{onClick:e[2]||(e[2]=(...e)=>t.onBulkSync&&t.onBulkSync(...e))},"bulkSync")])])):(0,o.kq)("",!0),t.isStravaLoggin?(0,o.kq)("",!0):((0,o.wg)(),(0,o.iD)("div",rt,[st,(0,o.wy)((0,o._)("input",{type:"text",id:"clientID",name:"clientID","onUpdate:modelValue":e[3]||(e[3]=e=>t.clientId=e)},null,512),[[n.nr,t.clientId]]),it,lt,ct,(0,o.wy)((0,o._)("input",{type:"password",id:"clientSecret",name:"clientSecret","onUpdate:modelValue":e[4]||(e[4]=e=>t.clientSecret=e)},null,512),[[n.nr,t.clientSecret]]),dt,ut,(0,o._)("input",{type:"submit",value:"OAuth",onClick:e[5]||(e[5]=(...e)=>t.onOauthLogin&&t.onOauthLogin(...e))})])),ht,gt,t.isRideAppReady?((0,o.wg)(),(0,o.iD)("button",{key:2,onClick:e[6]||(e[6]=(...e)=>t.onRunApp&&t.onRunApp(...e))},"RUN")):(0,o.kq)("",!0),t.isRunningAppReady?((0,o.wg)(),(0,o.iD)("button",{key:3,onClick:e[7]||(e[7]=(...e)=>t.onRideApp&&t.onRideApp(...e))},"RIDE")):(0,o.kq)("",!0),t.isLoading?((0,o.wg)(),(0,o.iD)("div",pt," The metadata you have at this time is in the loading process \\t "+(0,Q.zw)(t.foundData)+" \\t workouts ",1)):(0,o.kq)("",!0),(0,o.Wm)(l)])}const yt=(0,o._)("h1",null,"Dashboard",-1),wt=(0,o._)("thead",null,[(0,o._)("tr",null,[(0,o._)("th",null,"Metadata ID"),(0,o._)("th",null,"Sport"),(0,o._)("th",null,"Start Time"),(0,o._)("th",null,"Average Power"),(0,o._)("th",null,"Average Speed"),(0,o._)("th",null,"Average Heart Rate"),(0,o._)("th",null,"Total Time"),(0,o._)("th",null,"Total Distance"),(0,o._)("th",null," Count"),(0,o._)("th",null,"actions")])],-1);function ft(t,e,a,n,r,s){const i=(0,o.up)("DashboardRow");return(0,o.wg)(),(0,o.iD)("div",null,[yt,(0,o._)("table",null,[wt,((0,o.wg)(!0),(0,o.iD)(o.HY,null,(0,o.Ko)(t.rowData,(t=>((0,o.wg)(),(0,o.iD)("tbody",{key:t.metadata.metadataId},[(0,o.Wm)(i,{msg:t.metadata,autoSync:t.autoSync,bulkSync:t.bulkSync},null,8,["msg","autoSync","bulkSync"])])))),128))])])}const Dt={key:0},vt={key:1};function bt(t,e,a,n,r,s){return(0,o.wg)(),(0,o.iD)("tr",null,[(0,o._)("td",null,(0,Q.zw)(t.msg.metadataId),1),(0,o._)("td",null,(0,Q.zw)(t.msg.sport),1),(0,o._)("td",null,(0,Q.zw)(t.msg.startTime),1),(0,o._)("td",null,(0,Q.zw)(t.msg.averagePower),1),(0,o._)("td",null,(0,Q.zw)(t.msg.averageSpeed),1),(0,o._)("td",null,(0,Q.zw)(t.msg.averageHeartRate),1),(0,o._)("td",null,(0,Q.zw)(t.msg.totalTime),1),(0,o._)("td",null,(0,Q.zw)(t.msg.totalDistance),1),(0,o._)("td",null,(0,Q.zw)(t.msg.workoutDataCount),1),(0,o._)("td",null,[t.isReadyToSync?((0,o.wg)(),(0,o.iD)("button",{key:0,onClick:e[0]||(e[0]=(...e)=>t.getWorkout&&t.getWorkout(...e))},"sync")):(0,o.kq)("",!0)]),t.autoSync?((0,o.wg)(),(0,o.iD)("td",Dt,'"autoSync"')):(0,o.kq)("",!0),t.bulkSync?((0,o.wg)(),(0,o.iD)("td",vt,'"bulkSync"')):(0,o.kq)("",!0)])}const kt="id,lat,long,timerTime,power,speed,heartRate";function St(t,e){const a=kt.split(","),n=e.latlng.data.map((t=>t[0])),o=e.latlng.data.map((t=>t[1])),r=e.time?.data??Array(n.length).fill(-1),s=e.watts?.data??Array(n.length).fill(-1),i=e.velocity_smooth?.data??Array(n.length).fill(-1),l=e.heartrate?.data??Array(n.length).fill(-1),c=[];for(let d=0;d<n.length;d++){const e=a.map((e=>{switch(e){case"id":return t;case"lat":return n[d]?.toString()??"";case"long":return o[d]?.toString()??"";case"timerTime":return r[d]?.toString()??"";case"power":return s[d]?.toString()??"";case"speed":return i[d]?3.6*i[d]:0;case"heartRate":return l[d]?.toString()??"";default:return""}}));c.push(e.join(","))}return{header:kt,CSV:c.join("\n")}}const Tt="id,sport,startTime,averagePower,averageSpeed,averageHearRate,totalTime,totalDistance",_t=t=>({averageHeartRate:t.average_heartrate,averagePower:t.average_watts,averageSpeed:3.6*t.average_speed,metadataId:t.id,sport:t.type,startTime:t.start_date,totalDistance:t.distance,totalTime:t.elapsed_time,workoutDataCount:0}),Rt=t=>t.map((t=>_t(t)));function Ct(t){const e=Tt.split(","),a=e.map((e=>{switch(e){case"id":return t.metadataId;case"sport":return t?.sport??"";case"startTime":return t?.startTime??"";case"averagePower":return t?.averagePower?.toString()??"";case"averageSpeed":return t?.averageSpeed?.toString()??"";case"averageHearRate":return t?.averageHeartRate?.toString()??"";case"totalTime":return t?.totalTime?.toString()??"";case"totalDistance":return t?.totalDistance?.toString()??"";default:return""}}));return a.join(",")}function It(t){return{header:Tt,CSV:t.map((t=>Ct(t))).join("\n")}}const Lt="low",Ot="https://www.strava.com/api/v3",At=t=>Ot+"/athlete/activities?unit_system=metric&page="+t,jt=(t,e)=>Ot+"/activities/"+t+"/streams?keys=latlng,watts,heartrate,time,velocity_smooth&resolution="+e+"&key_by_type=true",Zt=t=>({getMetadata:e=>({header:{"Content-Type":"application/json",Authorization:"Bearer "+t.accessToken},method:"GET",url:At(e)}),getWorkout:e=>({header:{"Content-Type":"application/json",Authorization:"Bearer "+t.accessToken},method:"GET",url:jt(e,Lt)}),getWorkoutWithResolution:(e,a)=>({header:{"Content-Type":"application/json",Authorization:"Bearer "+t.accessToken},method:"GET",url:jt(e,a)})});async function*Pt(t){const e=Zt(t).getMetadata;let a=1,n=0;const o=[];do{const t=e(a),r=await(await fetch(t.url,{method:t.method,headers:t.header})).json();n=r.length,0!==n&&(o.push(...Rt(r)),yield{data:o,msg:"load"}),a++}while(0!==n);return yield{data:o,msg:"finished"}}var Ut=function(t,e,a,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(s=(r<3?o(s):r>3?o(e,a,s):o(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s};let zt=class extends l.w3{constructor(...t){super(...t),(0,i.Z)(this,"autoSync",void 0),(0,i.Z)(this,"bulkSync",void 0),(0,i.Z)(this,"msg",void 0),(0,i.Z)(this,"client",void 0),(0,i.Z)(this,"isReadyToSync",!1)}getWorkout(){if(console.log(""),0==this.isReadyToSync)return void console.log("no sync");this.isReadyToSync=!1;const t=d.getters.getClientData;if(t&&t.stravaToken){const e=Zt(t.stravaToken).getWorkout(this.msg.metadataId);fetch(e.url,{method:e.method,headers:e.header}).then((async t=>{console.log(t);const e=await t.json();let a=St(this.msg.metadataId,e);if(null!=this.client){console.log(e.time.data.length),this.msg.workoutDataCount=e.time.data.length;let t=L.workoutDataInsert(this.client?.myLoginToken,this.msg.metadataId,a.header,a.CSV);fetch(t.url,{method:t.method,body:t.body,headers:t.header}).then((t=>{console.log("response success"),d.dispatch("setDashboardDataSyncCount",this.msg)}))}}))}}mounted(){this.client=d.getters.getClientData,this.isReadyToSync=null!=this.client?.stravaToken?.accessToken&&0==this.msg.workoutDataCount,d.watch((()=>d.getters.getSync),(t=>{this.bulkSync&&(console.log(this.msg.metadataId),this.getWorkout())})),this.autoSync&&this.getWorkout()}};zt=Ut([(0,l.Ei)({props:{msg:{type:Object},autoSync:{type:Object},bulkSync:{type:Object}}})],zt);var Mt=zt;const xt=(0,h.Z)(Mt,[["render",bt]]);var Wt=xt,$t=function(t,e,a,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(s=(r<3?o(s):r>3?o(e,a,s):o(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s};let Jt=class extends l.w3{constructor(...t){super(...t),(0,i.Z)(this,"rowData",[]),(0,i.Z)(this,"dashboardData",[])}mounted(){var t=d.getters.getDashboardData;console.log(t),this.dashboardData=t;let e=30,a=0;this.rowData=this.dashboardData.map(((t,n)=>{const o=t.workoutDataCount>1;return a=o?a+1:a,{metadata:t,autoSync:n<=e+a&&!o,bulkSync:e+a<n&&n<=a+2*e&&!o}})),d.watch((()=>d.getters.getDashboardData),(t=>{this.dashboardData=t;let a=0;this.rowData=this.dashboardData.map(((t,n)=>{const o=t.workoutDataCount>1;return a=o?a+1:a,{metadata:t,autoSync:n<=e+a&&!o,bulkSync:e+a<n&&n<=a+2*e&&!o}})),console.log(this.rowData)})),console.log(this.rowData)}};Jt=$t([(0,l.Ei)({components:{DashboardRow:Wt},props:{msg:{type:[],required:!0}}})],Jt);var Vt=Jt;const qt=(0,h.Z)(Vt,[["render",ft]]);var Et=qt;class Ht{constructor(){(0,i.Z)(this,"ip",""),(0,i.Z)(this,"port","")}getUrl(){return`${this.ip}${this.port}`}}var Bt=function(t,e,a,n){var o,r=arguments.length,s=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,a):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)s=Reflect.decorate(t,e,a,n);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(s=(r<3?o(s):r>3?o(e,a,s):o(e,a))||s);return r>3&&s&&Object.defineProperty(e,a,s),s};let Nt=class extends l.w3{constructor(...t){super(...t),(0,i.Z)(this,"client",null),(0,i.Z)(this,"clientId",""),(0,i.Z)(this,"clientSecret",""),(0,i.Z)(this,"myToken",""),(0,i.Z)(this,"isStravaLoggin",!1),(0,i.Z)(this,"isLoading",!1),(0,i.Z)(this,"foundData",0),(0,i.Z)(this,"isRunningAppReady",!1),(0,i.Z)(this,"isRideAppReady",!1),(0,i.Z)(this,"server",new R),(0,i.Z)(this,"uiServer",new Ht)}onLoadLatestMetadata(){if(this.client&&this.client.stravaToken){let t=Zt(this.client.stravaToken).getMetadata(1);fetch(t.url,{method:t.method,headers:t.header}).then((async t=>{let e=await t.json();const a=Rt(e),n=d.getters.getDashboardData,o=a.filter((t=>0==n.filter((e=>e.metadataId==t.metadataId)).length));let r=It(o);if(console.log(r),null!=this.client){d.dispatch("addDashboardData",o);let t=L.metaDataInsert(this.client.myLoginToken,r.header,r.CSV);fetch(t.url,{method:t.method,body:t.body,headers:t.header})}}))}}async onLoadAllMetadata(){if(null!=this.client&&this.client.stravaToken){const t=Pt(this.client.stravaToken);for await(const e of t)if(this.isLoading=!0,console.log(e),this.foundData=e.data.length,"finished"==e.msg){this.isLoading=!1;const t=d.getters.getDashboardData,a=e.data,n=a.filter((e=>0==t.filter((t=>t.metadataId==e.metadataId)).length));console.log("newdata",n);const o=It(n),r=L.metaDataInsert(this.client.myLoginToken,o.header,o.CSV);d.dispatch("addDashboardData",n),fetch(r.url,{method:r.method,body:r.body,headers:r.header})}}}onOauthLogin(){console.log(this.myToken);let t="https://www.strava.com/oauth/authorize?client_id="+this.clientId+"&response_type=code&redirect_uri="+new URL(document.URL).origin+"/OAuthFlow&approval_prompt=force&scope=read_all,activity:read_all,profile:read_all";console.log("oauth",this.clientId),d.dispatch("updateClientIDandSecrect",{clientID:this.clientId,clientSecret:this.clientSecret});const e=L.setStravaData(this.myToken,this.clientId,this.clientSecret);console.log(e),fetch(e.url,{method:e.method,body:e.body,headers:e.header}),window.location.assign(t)}onBulkSync(){console.log(""),d.dispatch("fireSync",[])}onRunApp(){console.log("runapp"),sessionStorage.setItem("url",this.server.getRunUrl()),sessionStorage.setItem("accessToken",this.client?.myLoginToken??""),window.location.assign(new URL(document.URL).origin+"/app")}onRideApp(){console.log("rideApp"),sessionStorage.setItem("url",this.server.getRideUrl()),sessionStorage.setItem("accessToken",this.client?.myLoginToken??""),window.location.assign(new URL(document.URL).origin+"/app")}mounted(){this.client=d.getters.getClientData,console.log(this.client),this.clientId=this.client?.clientId??"",this.clientSecret=this.client?.clientSecret??"",this.myToken=this.client?.myLoginToken??"notoken",this.client=d.getters.getClientData,null!=this.client.stravaToken&&(this.isStravaLoggin=!0),d.watch((()=>d.getters.getDashboardData),(t=>{let e=t.filter((t=>"Run"==t.sport)).filter((t=>t.workoutDataCount>1)).length,a=t.filter((t=>"Ride"==t.sport)).filter((t=>t.workoutDataCount>1)).length;console.log("run count",e),this.isRideAppReady=e>1,this.isRunningAppReady=a>1}));var t=d.getters.getDashboardData;let e=t.filter((t=>"Run"==t.sport)).filter((t=>t.workoutDataCount>1)).length,a=t.filter((t=>"Ride"==t.sport)).filter((t=>t.workoutDataCount>1)).length;console.log("run count",e),this.isRideAppReady=e>1,this.isRunningAppReady=a>1}};Nt=Bt([(0,l.Ei)({components:{DashboardTable:Et}})],Nt);var Ft=Nt;const Gt=(0,h.Z)(Ft,[["render",mt]]);var Kt=Gt;const Yt=(0,o._)("h1",null,"OAutho Flow",-1);function Qt(t,e,a,n,r,s){return(0,o.wg)(),(0,o.iD)("div",null,[Yt,(0,o._)("p",null,"client: "+(0,Q.zw)(t.client?.username),1),(0,o._)("p",null,"client: "+(0,Q.zw)(t.client?.clientId),1),(0,o._)("p",null,"client: "+(0,Q.zw)(t.client?.clientSecret),1),(0,o._)("p",null,"jwt token: "+(0,Q.zw)(t.myToken),1),(0,o._)("p",null,"Authorization code: "+(0,Q.zw)(t.authorizationCode),1),(0,o._)("button",{onClick:e[0]||(e[0]=(...e)=>t.onClick&&t.onClick(...e))},"click me")])}class Xt extends l.w3{constructor(...t){super(...t),(0,i.Z)(this,"client",null),(0,i.Z)(this,"dashboardData",[])}get authorizationCode(){return this.$route.query.code}get myToken(){const t=sessionStorage.getItem("accessToken")??"";return console.log(t),t}onClick(){this.logInStrava()}logInStrava(){const t=new URLSearchParams;var e={ClientID:this.client?.clientId??"",ClientSecret:this.client?.clientSecret??"",Code:this.authorizationCode};console.log("keys,",e),t.append("client_id",e.ClientID),t.append("client_secret",e.ClientSecret),t.append("code",e.Code),t.append("grant_type","authorization_code"),t.append("Content-Type","application/x-www-form-urlencoded");const a="https://www.strava.com/oauth/token";console.log("form",t.toString()),fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:t.toString()}).then((t=>(console.log(t),t.json()))).then((t=>{console.log(t);const e={accessToken:t.access_token,refreshToken:t.refresh_token};d.dispatch("setClientStravaData",e);const a=JSON.parse(JSON.stringify(d.getters.getClientData));console.log(a.stravaToken),this.$router.push({name:"Dashboard"})}))}mounted(){const t=L.refresh(this.myToken);console.log(t.url),console.log(t.header),fetch(t.url,{method:t.method,headers:t.header}).then((t=>t.json())).then((t=>{let e=O.fromJson(t);e.toStore(),this.client=d.getters.getClientData,console.log(this.client),this.logInStrava()}))}}const te=(0,h.Z)(Xt,[["render",Qt]]);var ee=te;const ae=[{path:"/",component:U,name:"Login"},{path:"/register",component:Y,name:"Register"},{path:"/dashboard",component:Kt,name:"Dashboard"},{path:"/OAuthFLow",component:ee}];var ne=(0,m.p7)({history:(0,m.PO)(),routes:ae});const oe=(0,n.ri)(p);oe.use(d),oe.use(ne),oe.mount("#app")}},e={};function a(n){var o=e[n];if(void 0!==o)return o.exports;var r=e[n]={exports:{}};return t[n].call(r.exports,r,r.exports,a),r.exports}a.m=t,function(){var t=[];a.O=function(e,n,o,r){if(!n){var s=1/0;for(d=0;d<t.length;d++){n=t[d][0],o=t[d][1],r=t[d][2];for(var i=!0,l=0;l<n.length;l++)(!1&r||s>=r)&&Object.keys(a.O).every((function(t){return a.O[t](n[l])}))?n.splice(l--,1):(i=!1,r<s&&(s=r));if(i){t.splice(d--,1);var c=o();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[n,o,r]}}(),function(){a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,{a:e}),e}}(),function(){a.d=function(t,e){for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};a.O.j=function(e){return 0===t[e]};var e=function(e,n){var o,r,s=n[0],i=n[1],l=n[2],c=0;if(s.some((function(e){return 0!==t[e]}))){for(o in i)a.o(i,o)&&(a.m[o]=i[o]);if(l)var d=l(a)}for(e&&e(n);c<s.length;c++)r=s[c],a.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return a.O(d)},n=self["webpackChunklogin_view"]=self["webpackChunklogin_view"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=a.O(void 0,[998],(function(){return a(1337)}));n=a.O(n)})();
//# sourceMappingURL=app.488a1c0d.js.map